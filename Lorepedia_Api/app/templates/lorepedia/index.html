<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Lorepedia</title>
    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}"/> 
    <link rel="stylesheet" href="{{ url_for('static', filename='css/estilo_Index.css') }}"/>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='Recursos Principal/imagenes/Lorepedia Logo 3.png') }}">
    
</head>
<body>
    <div class="container">
        <img
            src="{{ url_for('static', filename='Recursos Principal/imagenes/Lorepedia Logo 1.png') }}"
            alt="Logo de Lorepedia"
            class="logo-image" 
        />
        
        <h1 class="main-title">LOREPEDIA</h1>

        <p class="tagline main-description">
            La enciclopedia de personajes donde cada historia, cada detalle y cada destino se une en un mismo lugar.
            Explora, descubre y aporta al conocimiento compartido.
        </p>

        <div class="main-actions">
            <a class="btn" href="/personajes">Personajes</a>
            <a class="btn" href="/login">Iniciar sesi√≥n</a>
        </div>
        
        <div class="music-player">
            <button id="music-btn" class="btn-music" type="button">üé∂ Reproducir m√∫sica</button>
            <div class="volume-wrap">
                <input id="volume-range" type="range" min="0" max="100" value="25" step="1" aria-label="Volumen"/>
                <span id="volume-label">25%</span>
            </div>
        </div>
    </div>

    <audio id="bg-music" loop preload="auto">
        <source src="{{ url_for('static', filename='Recursos Principal/musica/Gerson.mp3') }}" type="audio/mpeg">
        Tu navegador no soporta audio en HTML5.
    </audio>

    <div id="music-modal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-desc" hidden>
        <div class="modal">
            <h2 id="modal-title">¬øHabilitar m√∫sica de fondo?</h2>
            <p id="modal-desc">Esta p√°gina reproduce m√∫sica ambiental en bucle. Puedes activar o desactivar cuando quieras.</p>
            <div class="modal-actions">
                <button id="enable-audio" class="btn-music" type="button">S√≠, habilitar</button>
                <button id="dismiss-audio" class="btn-secondary" type="button">No, gracias</button>
            </div>
            <small class="modal-note">Tu preferencia se guardar√° para pr√≥ximas p√°ginas.</small>
        </div>
    </div>

    <script>
        // ===== Claves y utilidades de persistencia =====
        const STORAGE_KEY = 'lorepedia_music_prefs';
        const defaults = { decided: false, enabled: false, volume: 0.25, muted: false };

        const loadPrefs = () => {
          try {
            const raw = localStorage.getItem(STORAGE_KEY);
            return raw ? { ...defaults, ...JSON.parse(raw) } : { ...defaults };
          } catch { return { ...defaults }; }
        };
        const savePrefs = (p) => {
          try { localStorage.setItem(STORAGE_KEY, JSON.stringify(p)); } catch {}
        };

        // ===== Elementos =====
        const audio = document.getElementById('bg-music');
        const btn ¬† = document.getElementById('music-btn');
        const range = document.getElementById('volume-range');
        const label = document.getElementById('volume-label');
        const modal = document.getElementById('music-modal');
        const enableBtn ¬†= document.getElementById('enable-audio');
        const dismissBtn = document.getElementById('dismiss-audio');

        function closeModal() {
          modal.hidden = true;
          modal.style.display = 'none';
        }
        function openModal() {
          modal.hidden = false;
          modal.style.display = '';
        }

        // ===== Estado inicial =====
        const prefs = loadPrefs();
        audio.volume = prefs.volume;
        range.value ¬†= Math.round(prefs.volume * 100);
        label.textContent = `${range.value}%`;

        if (prefs.decided) {
          if (prefs.enabled) {
            audio.play().then(() => {
              btn.textContent = '‚è∏Ô∏è Pausar m√∫sica';
            }).catch(() => {/* el bot√≥n seguir√° funcionando */});
          }
        } else {
          openModal();
        }

        // ===== Modal: Aceptar m√∫sica =====
        enableBtn?.addEventListener('click', async () => {
          prefs.decided = true;
          prefs.enabled = true;
          prefs.volume ¬†= audio.volume = Number(range.value) / 100 || 0.25;
          savePrefs(prefs);
          try {
            await audio.play(); // este click cuenta como gesto
            btn.textContent = '‚è∏Ô∏è Pausar m√∫sica';
          } catch (e) {
            console.error('No se pudo reproducir el audio:', e);
          }
          closeModal();
        });

        // ===== Modal: Rechazar m√∫sica =====
        dismissBtn?.addEventListener('click', () => {
          prefs.decided = true;
          prefs.enabled = false;
          savePrefs(prefs);
          audio.pause();
          btn.textContent = 'üé∂ Reproducir m√∫sica';
          closeModal();
        });

        // ===== Bot√≥n Play/Pause principal =====
        btn.addEventListener('click', async () => {
          try {
            if (audio.paused) {
              await audio.play();
              btn.textContent = '‚è∏Ô∏è Pausar m√∫sica';
              prefs.decided = true;
              prefs.enabled = true;
              savePrefs(prefs);
            } else {
              audio.pause();
              btn.textContent = 'üé∂ Reproducir m√∫sica';
              prefs.decided = true;
              prefs.enabled = false;
              savePrefs(prefs);
            }
          } catch (e) {
            console.error('No se pudo reproducir el audio:', e);
          }
        });

        audio.addEventListener('pause', () => (btn.textContent = 'üé∂ Reproducir m√∫sica'));
        audio.addEventListener('play', ¬†() => (btn.textContent = '‚è∏Ô∏è Pausar m√∫sica'));

        // ===== Slider de volumen =====
        range.addEventListener('input', () => {
          const v = Number(range.value) / 100;
          audio.volume = v;
          label.textContent = `${range.value}%`;
          prefs.volume = v;
          savePrefs(prefs);
        });
    </script>
</body>
</html>


